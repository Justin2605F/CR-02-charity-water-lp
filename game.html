<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Fill the Tank! — Gameplay</title>
  <link rel="stylesheet" href="game.css" />
</head>
<body>
  <main class="frame">

    <!-- Top bar -->
    <header class="topbar">
      <!-- Logo -->
      <img src="https://upleaf.com/wp-content/uploads/2014/01/mass-images-charity_water_logo-110502-large.jpg" alt="charity: water" class="logo">

      <div class="timer">
        <span class="timer__label">Timer:</span>
        <span class="timer__value" id="timer">30</span><span class="timer__unit">s</span>
      </div>
    </header>

    <!-- Score -->
    <section class="score">
      <div class="score__label">Score:</div>
      <div class="score__value"><span id="liters">0</span> <span class="score__unit">Liters</span></div>
    </section>

    <!-- Scene -->
    <section class="scene">
      <!-- Left palm tree -->
      <svg class="palm palm--left" viewBox="0 0 120 750" aria-hidden="true">
        <!-- Detailed curved trunk with texture -->
        <path d="M 50 350 Q 48 420 50 500 Q 52 570 50 650" stroke="#8B5A2B" stroke-width="28" fill="none" stroke-linecap="round"/>
        <path d="M 50 350 Q 52 420 50 500 Q 48 570 50 650" stroke="#704214" stroke-width="24" fill="none" stroke-linecap="round"/>
        
        <!-- Trunk rings/segments -->
        <circle cx="50" cy="380" r="14" fill="none" stroke="#654321" stroke-width="1"/>
        <circle cx="50" cy="420" r="14" fill="none" stroke="#654321" stroke-width="1"/>
        <circle cx="50" cy="460" r="14" fill="none" stroke="#654321" stroke-width="1"/>
        <circle cx="50" cy="500" r="14" fill="none" stroke="#654321" stroke-width="1"/>
        <circle cx="50" cy="540" r="14" fill="none" stroke="#654321" stroke-width="1"/>
        <circle cx="50" cy="580" r="14" fill="none" stroke="#654321" stroke-width="1"/>
        <circle cx="50" cy="620" r="14" fill="none" stroke="#654321" stroke-width="1"/>
        
        <!-- Large radiating palm fronds (leaves) -->
        <ellipse cx="50" cy="180" rx="18" ry="100" fill="#2E8B57" stroke="#1a5c2e" stroke-width="1.5" transform="rotate(0 50 180)"/>
        <line x1="50" y1="180" x2="50" y2="100" stroke="#1a5c2e" stroke-width="1" opacity="0.6"/>
        
        <ellipse cx="25" cy="220" rx="16" ry="85" fill="#32CD32" stroke="#228B22" stroke-width="1.5" transform="rotate(-45 25 220)"/>
        <ellipse cx="15" cy="260" rx="14" ry="80" fill="#3CB371" stroke="#228B22" stroke-width="1.5" transform="rotate(-60 15 260)"/>
        
        <ellipse cx="75" cy="220" rx="16" ry="85" fill="#32CD32" stroke="#228B22" stroke-width="1.5" transform="rotate(45 75 220)"/>
        <ellipse cx="85" cy="260" rx="14" ry="80" fill="#3CB371" stroke="#228B22" stroke-width="1.5" transform="rotate(60 85 260)"/>
        
        <ellipse cx="20" cy="300" rx="13" ry="75" fill="#228B22" stroke="#1a6b1a" stroke-width="1.5" transform="rotate(-70 20 300)"/>
        <ellipse cx="10" cy="340" rx="12" ry="70" fill="#2E8B57" stroke="#1a5c2e" stroke-width="1.5" transform="rotate(-75 10 340)"/>
        
        <ellipse cx="80" cy="300" rx="13" ry="75" fill="#228B22" stroke="#1a6b1a" stroke-width="1.5" transform="rotate(70 80 300)"/>
        <ellipse cx="90" cy="340" rx="12" ry="70" fill="#2E8B57" stroke="#1a5c2e" stroke-width="1.5" transform="rotate(75 90 340)"/>
        
        <ellipse cx="30" cy="360" rx="11" ry="65" fill="#3CB371" stroke="#228B22" stroke-width="1.5" transform="rotate(-50 30 360)"/>
        <ellipse cx="70" cy="360" rx="11" ry="65" fill="#3CB371" stroke="#228B22" stroke-width="1.5" transform="rotate(50 70 360)"/>
        
        <!-- Coconuts cluster -->
        <circle cx="48" cy="320" r="10" fill="#FFD700" stroke="#FFA500" stroke-width="2"/>
        <circle cx="52" cy="320" r="10" fill="#FFD700" stroke="#FFA500" stroke-width="2"/>
        <circle cx="50" cy="335" r="9" fill="#FFA500" stroke="#FF8C00" stroke-width="2"/>
        <circle cx="45" cy="345" r="8" fill="#FFD700" stroke="#FFA500" stroke-width="1.5"/>
        <circle cx="55" cy="345" r="8" fill="#FFD700" stroke="#FFA500" stroke-width="1.5"/>
        
        <!-- Grass at base -->
        <path d="M 35 690 Q 33 670 30 695" stroke="#2E8B57" stroke-width="2.5" fill="none" stroke-linecap="round"/>
        <path d="M 45 695 Q 43 675 40 700" stroke="#2E8B57" stroke-width="2.5" fill="none" stroke-linecap="round"/>
        <path d="M 55 695 Q 53 675 50 700" stroke="#2E8B57" stroke-width="2.5" fill="none" stroke-linecap="round"/>
        <path d="M 65 695 Q 63 675 60 700" stroke="#2E8B57" stroke-width="2.5" fill="none" stroke-linecap="round"/>
        <path d="M 75 690 Q 73 670 70 695" stroke="#2E8B57" stroke-width="2.5" fill="none" stroke-linecap="round"/>
      </svg>
      
      <!-- Right palm tree -->
      <svg class="palm palm--right" viewBox="0 0 120 750" aria-hidden="true">
        <!-- Detailed curved trunk with texture -->
        <path d="M 50 350 Q 48 420 50 500 Q 52 570 50 650" stroke="#8B5A2B" stroke-width="28" fill="none" stroke-linecap="round"/>
        <path d="M 50 350 Q 52 420 50 500 Q 48 570 50 650" stroke="#704214" stroke-width="24" fill="none" stroke-linecap="round"/>
        
        <!-- Trunk rings/segments -->
        <circle cx="50" cy="380" r="14" fill="none" stroke="#654321" stroke-width="1"/>
        <circle cx="50" cy="420" r="14" fill="none" stroke="#654321" stroke-width="1"/>
        <circle cx="50" cy="460" r="14" fill="none" stroke="#654321" stroke-width="1"/>
        <circle cx="50" cy="500" r="14" fill="none" stroke="#654321" stroke-width="1"/>
        <circle cx="50" cy="540" r="14" fill="none" stroke="#654321" stroke-width="1"/>
        <circle cx="50" cy="580" r="14" fill="none" stroke="#654321" stroke-width="1"/>
        <circle cx="50" cy="620" r="14" fill="none" stroke="#654321" stroke-width="1"/>
        
        <!-- Large radiating palm fronds (leaves) -->
        <ellipse cx="50" cy="180" rx="18" ry="100" fill="#2E8B57" stroke="#1a5c2e" stroke-width="1.5" transform="rotate(0 50 180)"/>
        <line x1="50" y1="180" x2="50" y2="100" stroke="#1a5c2e" stroke-width="1" opacity="0.6"/>
        
        <ellipse cx="25" cy="220" rx="16" ry="85" fill="#32CD32" stroke="#228B22" stroke-width="1.5" transform="rotate(-45 25 220)"/>
        <ellipse cx="15" cy="260" rx="14" ry="80" fill="#3CB371" stroke="#228B22" stroke-width="1.5" transform="rotate(-60 15 260)"/>
        
        <ellipse cx="75" cy="220" rx="16" ry="85" fill="#32CD32" stroke="#228B22" stroke-width="1.5" transform="rotate(45 75 220)"/>
        <ellipse cx="85" cy="260" rx="14" ry="80" fill="#3CB371" stroke="#228B22" stroke-width="1.5" transform="rotate(60 85 260)"/>
        
        <ellipse cx="20" cy="300" rx="13" ry="75" fill="#228B22" stroke="#1a6b1a" stroke-width="1.5" transform="rotate(-70 20 300)"/>
        <ellipse cx="10" cy="340" rx="12" ry="70" fill="#2E8B57" stroke="#1a5c2e" stroke-width="1.5" transform="rotate(-75 10 340)"/>
        
        <ellipse cx="80" cy="300" rx="13" ry="75" fill="#228B22" stroke="#1a6b1a" stroke-width="1.5" transform="rotate(70 80 300)"/>
        <ellipse cx="90" cy="340" rx="12" ry="70" fill="#2E8B57" stroke="#1a5c2e" stroke-width="1.5" transform="rotate(75 90 340)"/>
        
        <ellipse cx="30" cy="360" rx="11" ry="65" fill="#3CB371" stroke="#228B22" stroke-width="1.5" transform="rotate(-50 30 360)"/>
        <ellipse cx="70" cy="360" rx="11" ry="65" fill="#3CB371" stroke="#228B22" stroke-width="1.5" transform="rotate(50 70 360)"/>
        
        <!-- Coconuts cluster -->
        <circle cx="48" cy="320" r="10" fill="#FFD700" stroke="#FFA500" stroke-width="2"/>
        <circle cx="52" cy="320" r="10" fill="#FFD700" stroke="#FFA500" stroke-width="2"/>
        <circle cx="50" cy="335" r="9" fill="#FFA500" stroke="#FF8C00" stroke-width="2"/>
        <circle cx="45" cy="345" r="8" fill="#FFD700" stroke="#FFA500" stroke-width="1.5"/>
        <circle cx="55" cy="345" r="8" fill="#FFD700" stroke="#FFA500" stroke-width="1.5"/>
        
        <!-- Grass at base -->
        <path d="M 35 690 Q 33 670 30 695" stroke="#2E8B57" stroke-width="2.5" fill="none" stroke-linecap="round"/>
        <path d="M 45 695 Q 43 675 40 700" stroke="#2E8B57" stroke-width="2.5" fill="none" stroke-linecap="round"/>
        <path d="M 55 695 Q 53 675 50 700" stroke="#2E8B57" stroke-width="2.5" fill="none" stroke-linecap="round"/>
        <path d="M 65 695 Q 63 675 60 700" stroke="#2E8B57" stroke-width="2.5" fill="none" stroke-linecap="round"/>
        <path d="M 75 690 Q 73 670 70 695" stroke="#2E8B57" stroke-width="2.5" fill="none" stroke-linecap="round"/>
      </svg>

      <!-- Water quality indicator -->
      <div class="quality">
        <div class="quality__dot" id="qualityDot" aria-hidden="true"></div>
        <div class="quality__text">
          Water: <span id="qualityText">CLEAN</span>
        </div>
      </div>

      <!-- Tank -->
      <div class="tank-wrap">
        <div class="tank">
          <div class="scribble" id="scribble" aria-hidden="true"></div>
          <div class="tank__fill" id="tankFill"></div>

          <!-- falling drops (just visual) -->
          <div class="drop drop--1"></div>
          <div class="drop drop--2"></div>
          <div class="drop drop--3"></div>
          <div class="drop drop--4"></div>
          <div class="drop drop--5"></div>
        </div>

        <div class="tank-meta">
          <div class="tank-meta__text">
            Tank Fill: <span id="tankPct">0</span>%
          </div>

          <div class="bar">
            <div class="bar__fill" id="barFill"></div>
          </div>
        </div>
      </div>

      <!-- Pump area -->
      <div class="pump-area">
        <div class="pump" aria-hidden="true">
          <div class="pump__post"></div>
          <div class="pump__spout"></div>
          <div class="pump__bucket"></div>
        </div>

        <button class="pump-btn" id="pumpBtn">PUMP!</button>
      </div>

      <!-- End panel (hidden until time = 0) -->
      <aside class="end" id="endPanel" aria-hidden="true">
        <h2 class="end__title">Time's Up!</h2>
        <p class="end__text">You filled <b><span id="finalLiters">0</span> liters</b>.</p>

        <button class="end__btn" id="playAgainBtn">Play Again</button>
        <a class="end__btn end__btn--outline" href="https://www.charitywater.org" target="_blank" rel="noopener">
          Learn More
        </a>
      </aside>
    </section>

    <!-- Pump sound (optional audio cue) -->
    <audio id="pumpSound" preload="auto">
      <source src="data:audio/wav;base64,UklGRiYAAABXQVZFZm10IBAAAAABAAEAQB8AAAB9AAACABAAZGF0YQIAAAAAAA==" type="audio/wav">
    </audio>
  </main>

  <script>
    // ====== Beginner-friendly JS ======
    let liters = 0;
    let timeLeft = 30;

    // Tank "goal" — change this number to make it easier/harder
    const GOAL_LITERS = 100;

    // Water quality: CLEAN (blue) or DIRTY (brown)
    let isClean = true;

    const litersEl = document.getElementById("liters");
    const timerEl = document.getElementById("timer");
    const tankPctEl = document.getElementById("tankPct");
    const tankFillEl = document.getElementById("tankFill");
    const barFillEl = document.getElementById("barFill");
    const pumpBtn = document.getElementById("pumpBtn");

    const qualityDot = document.getElementById("qualityDot");
    const qualityText = document.getElementById("qualityText");
    
    const scribble = document.getElementById("scribble");
    const drops = document.querySelectorAll(".drop");
    const pumpSound = document.getElementById("pumpSound");

    const endPanel = document.getElementById("endPanel");
    const finalLiters = document.getElementById("finalLiters");
    const playAgainBtn = document.getElementById("playAgainBtn");

    function clamp(n, min, max) {
      return Math.max(min, Math.min(max, n));
    }

    function updateUI() {
      litersEl.textContent = liters;

      // percent progress based on GOAL_LITERS
      const pct = clamp(Math.round((liters / GOAL_LITERS) * 100), 0, 100);
      tankPctEl.textContent = pct;

      tankFillEl.style.height = pct + "%";
      barFillEl.style.width = pct + "%";
    }

    function setQuality(clean) {
      isClean = clean;

      // Update the dot + text
      if (isClean) {
        qualityDot.classList.remove("dirty");
        qualityText.textContent = "CLEAN";
      } else {
        qualityDot.classList.add("dirty");
        qualityText.textContent = "DIRTY";
      }

      // 1) Make droplets turn brown when dirty
      drops.forEach(d => {
        if (isClean) d.classList.remove("dirty");
        else d.classList.add("dirty");
      });

      // 2) Flash scribble cue behind the tank
      scribble.classList.remove("clean", "dirty");
      scribble.classList.add(isClean ? "clean" : "dirty");
    }

    // Randomly change water quality every 1.2–2.5 seconds
    function startQualityCycle() {
      function flip() {
        setQuality(Math.random() > 0.45); // ~55% clean, tweak if you want
        const next = 1200 + Math.random() * 1300;
        if (timeLeft > 0) setTimeout(flip, next);
      }
      flip();
    }

    // Timer countdown
    function startTimer() {
      const interval = setInterval(() => {
        timeLeft -= 1;
        timerEl.textContent = timeLeft;

        if (timeLeft <= 0) {
          clearInterval(interval);
          endGame();
        }
      }, 1000);
    }

    function endGame() {
      pumpBtn.disabled = true;
      endPanel.classList.add("end--open");
      endPanel.setAttribute("aria-hidden", "false");
      finalLiters.textContent = liters;
    }

    // Pump logic
    pumpBtn.addEventListener("click", () => {
      if (timeLeft <= 0) return;

      // 1) Play pump sound
      if (pumpSound) {
        pumpSound.currentTime = 0; // restart sound instantly
        pumpSound.play().catch(() => {}); // prevents errors if autoplay blocked
      }

      if (isClean) {
        liters += 1;        // reward
      } else {
        liters -= 2;        // penalty for pumping dirty water (change if you want)
      }
      liters = clamp(liters, 0, GOAL_LITERS);
      updateUI();
    });

    // Play again
    playAgainBtn.addEventListener("click", () => {
      liters = 0;
      timeLeft = 30;
      timerEl.textContent = timeLeft;
      pumpBtn.disabled = false;

      endPanel.classList.remove("end--open");
      endPanel.setAttribute("aria-hidden", "true");

      setQuality(true);
      updateUI();

      startQualityCycle();
      startTimer();
    });

    // Start the page
    setQuality(true);
    updateUI();
    startQualityCycle();
    startTimer();
  </script>
</body>
</html>
